"use strict";(globalThis.webpackChunkweb_story_creation_tool=globalThis.webpackChunkweb_story_creation_tool||[]).push([[3182],{84121:(t,e,n)=>{n.r(e),n.d(e,{getFontEmbedCSS:()=>z,toBlob:()=>O,toCanvas:()=>j,toJpeg:()=>B,toPixelData:()=>F,toPng:()=>_,toSvg:()=>H});var o=function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function c(t){try{u(o.next(t))}catch(t){i(t)}}function s(t){try{u(o.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,s)}u((o=o.apply(t,e||[])).next())}))};const r="application/font-woff",i="image/jpeg",c={woff:r,woff2:r,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:i,jpeg:i,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"};function s(t){const e=function(t){const e=/\.([^./]*?)$/g.exec(t);return e?e[1]:""}(t).toLowerCase();return c[e]||""}function u(t){return-1!==t.search(/^(data:)/)}function l(t,e){return`data:${e};base64,${t}`}const a=function(){let t=0;return()=>(t+=1,`u${`0000${(Math.random()*Math.pow(36,4)<<0).toString(36)}`.slice(-4)}${t}`)}();function h(t){const e=[];for(let n=0,o=t.length;n<o;n+=1)e.push(t[n]);return e}function f(t,e){const n=window.getComputedStyle(t).getPropertyValue(e);return parseFloat(n.replace("px",""))}function d(t){return t.toBlob?new Promise((e=>t.toBlob(e))):new Promise((e=>{const n=window.atob(t.toDataURL().split(",")[1]),o=n.length,r=new Uint8Array(o);for(let t=0;t<o;t+=1)r[t]=n.charCodeAt(t);e(new Blob([r],{type:"image/png"}))}))}function p(t){return new Promise(((e,n)=>{const o=new Image;o.onload=()=>e(o),o.onerror=n,o.crossOrigin="anonymous",o.decoding="sync",o.src=t}))}const g={};function m(t,e){const n=function(t){let e=t.replace(/\?.*/,"");return/ttf|otf|eot|woff2?/i.test(e)&&(e=e.replace(/.*\//,"")),e}(t);if(null!=g[n])return g[n];e.cacheBust&&(t+=(/\?/.test(t)?"&":"?")+(new Date).getTime());const o=window.fetch(t).then((t=>t.blob().then((e=>({blob:e,contentType:t.headers.get("Content-Type")||""}))))).then((({blob:t,contentType:e})=>new Promise(((n,o)=>{const r=new FileReader;r.onloadend=()=>n({contentType:e,blob:r.result}),r.onerror=o,r.readAsDataURL(t)})))).then((({blob:t,contentType:e})=>{return{contentType:e,blob:(n=t,n.split(/,/)[1])};var n})).catch((n=>{let o="";if(e.imagePlaceholder){const t=e.imagePlaceholder.split(/,/);t&&t[1]&&(o=t[1])}let r=`Failed to fetch resource: ${t}`;return n&&(r="string"==typeof n?n:n.message),r&&console.error(r),{blob:o,contentType:""}}));return g[n]=o,o}function v(t,e,n){const o=window.getComputedStyle(t,n),r=o.getPropertyValue("content");if(""===r||"none"===r)return;const i=a();try{e.className=`${e.className} ${i}`}catch(t){return}const c=document.createElement("style");c.appendChild(function(t,e,n){const o=`.${t}:${e}`,r=n.cssText?function(t){const e=t.getPropertyValue("content");return`${t.cssText} content: '${e.replace(/'|"/g,"")}';`}(n):function(t){return h(t).map((e=>`${e}: ${t.getPropertyValue(e)}${t.getPropertyPriority(e)?" !important":""};`)).join(" ")}(n);return document.createTextNode(`${o}{${r}}`)}(i,n,o)),e.appendChild(c)}var w=function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function c(t){try{u(o.next(t))}catch(t){i(t)}}function s(t){try{u(o.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,s)}u((o=o.apply(t,e||[])).next())}))};function y(t,e,n){return w(this,void 0,void 0,(function*(){return n||!e.filter||e.filter(t)?Promise.resolve(t).then((t=>function(t,e){return w(this,void 0,void 0,(function*(){return t instanceof HTMLCanvasElement?function(t){return w(this,void 0,void 0,(function*(){const e=t.toDataURL();return"data:,"===e?Promise.resolve(t.cloneNode(!1)):p(e)}))}(t):t instanceof HTMLVideoElement&&t.poster?function(t,e){return w(this,void 0,void 0,(function*(){return Promise.resolve(t.poster).then((t=>m(t,e))).then((e=>l(e.blob,s(t.poster)||e.contentType))).then((t=>p(t)))}))}(t,e):Promise.resolve(t.cloneNode(!1))}))}(t,e))).then((n=>function(t,e,n){var o;return w(this,void 0,void 0,(function*(){const r=null!=(i=t).tagName&&"SLOT"===i.tagName.toUpperCase()&&t.assignedNodes?h(t.assignedNodes()):h((null!==(o=t.shadowRoot)&&void 0!==o?o:t).childNodes);var i;return 0===r.length||t instanceof HTMLVideoElement?Promise.resolve(e):r.reduce(((t,o)=>t.then((()=>y(o,n))).then((t=>{t&&e.appendChild(t)}))),Promise.resolve()).then((()=>e))}))}(t,n,e))).then((e=>function(t,e){return w(this,void 0,void 0,(function*(){return e instanceof Element?Promise.resolve().then((()=>function(t,e){const n=window.getComputedStyle(t),o=e.style;o&&(n.cssText?o.cssText=n.cssText:h(n).forEach((t=>{o.setProperty(t,n.getPropertyValue(t),n.getPropertyPriority(t))})))}(t,e))).then((()=>function(t,e){v(t,e,":before"),v(t,e,":after")}(t,e))).then((()=>function(t,e){t instanceof HTMLTextAreaElement&&(e.innerHTML=t.value),t instanceof HTMLInputElement&&e.setAttribute("value",t.value)}(t,e))).then((()=>e)):Promise.resolve(e)}))}(t,e))):Promise.resolve(null)}))}const b=/url\((['"]?)([^'"]+?)\1\)/g,P=/url\([^)]+\)\s*format\((["'])([^"']+)\1\)/g,x=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function S(t){const e=[];return t.replace(b,((t,n,o)=>(e.push(o),t))),e.filter((t=>!u(t)))}function E(t){return-1!==t.search(b)}function T(t,e,n){return o=this,r=void 0,c=function*(){if(!E(t))return Promise.resolve(t);const o=function(t,{preferredFontFormat:e}){return e?t.replace(x,(t=>{for(;;){const[n,,o]=P.exec(t)||[];if(!o)return"";if(o===e)return`src: ${n};`}})):t}(t,n);return Promise.resolve(o).then(S).then((t=>t.reduce(((t,o)=>t.then((t=>function(t,e,n,o,r){const i=n?function(t,e){if(t.match(/^[a-z]+:\/\//i))return t;if(t.match(/^\/\//))return window.location.protocol+t;if(t.match(/^[a-z]+:/i))return t;const n=document.implementation.createHTMLDocument(),o=n.createElement("base"),r=n.createElement("a");return n.head.appendChild(o),n.body.appendChild(r),e&&(o.href=e),r.href=t,r.href}(e,n):e;return Promise.resolve(i).then((t=>r?r(t):m(t,o))).then((t=>"string"==typeof t?l(t,s(e)):l(t.blob,s(e)||t.contentType))).then((n=>t.replace(function(t){const e=t.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${e})(['"]?\\))`,"g")}(e),`$1${n}$3`))).then((t=>t),(()=>i))}(t,o,e,n)))),Promise.resolve(o))))},new((i=void 0)||(i=Promise))((function(t,e){function n(t){try{u(c.next(t))}catch(t){e(t)}}function s(t){try{u(c.throw(t))}catch(t){e(t)}}function u(e){var o;e.done?t(e.value):(o=e.value,o instanceof i?o:new i((function(t){t(o)}))).then(n,s)}u((c=c.apply(o,r||[])).next())}));var o,r,i,c}var C=function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function c(t){try{u(o.next(t))}catch(t){i(t)}}function s(t){try{u(o.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,s)}u((o=o.apply(t,e||[])).next())}))};function $(t,e){return C(this,void 0,void 0,(function*(){return t instanceof Element?Promise.resolve(t).then((t=>function(t,e){var n;return C(this,void 0,void 0,(function*(){const o=null===(n=t.style)||void 0===n?void 0:n.getPropertyValue("background");return o?Promise.resolve(o).then((t=>T(t,null,e))).then((e=>(t.style.setProperty("background",e,t.style.getPropertyPriority("background")),t))):Promise.resolve(t)}))}(t,e))).then((t=>function(t,e){return C(this,void 0,void 0,(function*(){if((!(t instanceof HTMLImageElement)||u(t.src))&&(!(t instanceof SVGImageElement)||u(t.href.baseVal)))return Promise.resolve(t);const n=t instanceof HTMLImageElement?t.src:t.href.baseVal;return Promise.resolve(n).then((t=>m(t,e))).then((t=>l(t.blob,s(n)||t.contentType))).then((e=>new Promise(((n,o)=>{t.onload=n,t.onerror=o,t instanceof HTMLImageElement?(t.srcset="",t.src=e):t.href.baseVal=e})))).then((()=>t),(()=>t))}))}(t,e))).then((t=>function(t,e){return C(this,void 0,void 0,(function*(){const n=h(t.childNodes).map((t=>$(t,e)));return Promise.all(n).then((()=>t))}))}(t,e))):Promise.resolve(t)}))}var R=function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function c(t){try{u(o.next(t))}catch(t){i(t)}}function s(t){try{u(o.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,s)}u((o=o.apply(t,e||[])).next())}))};const L={};function N(t){const e=L[t];if(null!=e)return e;const n=window.fetch(t).then((e=>({url:t,cssText:e.text()})));return L[t]=n,n}function k(t){return R(this,void 0,void 0,(function*(){return t.cssText.then((e=>{let n=e;const o=/url\(["']?([^"')]+)["']?\)/g,r=(n.match(/url\([^)]+\)/g)||[]).map((e=>{let r=e.replace(o,"$1");return r.startsWith("https://")||(r=new URL(r,t.url).href),window.fetch(r).then((t=>t.blob())).then((t=>new Promise(((o,r)=>{const i=new FileReader;i.onloadend=()=>{n=n.replace(e,`url(${i.result})`),o([e,i.result])},i.onerror=r,i.readAsDataURL(t)}))))}));return Promise.all(r).then((()=>n))}))}))}function A(t){if(null==t)return[];const e=[];let n=t.replace(/(\/\*[\s\S]*?\*\/)/gi,"");const o=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const t=o.exec(n);if(null===t)break;e.push(t[0])}n=n.replace(o,"");const r=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,i=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){let t=r.exec(n);if(null===t){if(t=i.exec(n),null===t)break;r.lastIndex=i.lastIndex}else i.lastIndex=r.lastIndex;e.push(t[0])}return e}function I(t){return t.filter((t=>t.type===CSSRule.FONT_FACE_RULE)).filter((t=>E(t.style.getPropertyValue("src"))))}function M(t,e){return R(this,void 0,void 0,(function*(){return function(t){return R(this,void 0,void 0,(function*(){return new Promise(((e,n)=>{null==t.ownerDocument&&n(new Error("Provided element is not within a Document")),e(h(t.ownerDocument.styleSheets))})).then((t=>function(t){return R(this,void 0,void 0,(function*(){const e=[],n=[];return t.forEach((e=>{if("cssRules"in e)try{h(e.cssRules).forEach(((t,o)=>{if(t.type===CSSRule.IMPORT_RULE){let r=o+1;const i=N(t.href).then((t=>t?k(t):"")).then((t=>A(t).forEach((t=>{try{e.insertRule(t,t.startsWith("@import")?r+=1:e.cssRules.length)}catch(e){console.error("Error inserting rule from remote css",{rule:t,error:e})}})))).catch((t=>{console.error("Error loading remote css",t.toString())}));n.push(i)}}))}catch(o){const r=t.find((t=>null==t.href))||document.styleSheets[0];null!=e.href&&n.push(N(e.href).then((t=>t?k(t):"")).then((t=>A(t).forEach((t=>{r.insertRule(t,e.cssRules.length)})))).catch((t=>{console.error("Error loading remote stylesheet",t.toString())}))),console.error("Error inlining remote css file",o.toString())}})),Promise.all(n).then((()=>(t.forEach((t=>{if("cssRules"in t)try{h(t.cssRules).forEach((t=>{e.push(t)}))}catch(e){console.error(`Error while reading CSS rules from ${t.href}`,e.toString())}})),e)))}))}(t))).then(I)}))}(t).then((t=>Promise.all(t.map((t=>{const n=t.parentStyleSheet?t.parentStyleSheet.href:null;return T(t.cssText,n,e)}))))).then((t=>t.join("\n")))}))}var D=function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function c(t){try{u(o.next(t))}catch(t){i(t)}}function s(t){try{u(o.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,s)}u((o=o.apply(t,e||[])).next())}))};function V(t,e={}){const n=e.width||function(t){const e=f(t,"border-left-width"),n=f(t,"border-right-width");return t.clientWidth+e+n}(t),o=e.height||function(t){const e=f(t,"border-top-width"),n=f(t,"border-bottom-width");return t.clientHeight+e+n}(t);return{width:n,height:o}}function H(t,e={}){return D(this,void 0,void 0,(function*(){const{width:n,height:r}=V(t,e);return Promise.resolve(t).then((t=>y(t,e,!0))).then((t=>function(t,e){return R(this,void 0,void 0,(function*(){return(null!=e.fontEmbedCSS?Promise.resolve(e.fontEmbedCSS):M(t,e)).then((e=>{const n=document.createElement("style"),o=document.createTextNode(e);return n.appendChild(o),t.firstChild?t.insertBefore(n,t.firstChild):t.appendChild(n),t}))}))}(t,e))).then((t=>$(t,e))).then((t=>function(t,e){const{style:n}=t;e.backgroundColor&&(n.backgroundColor=e.backgroundColor),e.width&&(n.width=`${e.width}px`),e.height&&(n.height=`${e.height}px`);const o=e.style;return null!=o&&Object.keys(o).forEach((t=>{n[t]=o[t]})),t}(t,e))).then((t=>function(t,e,n){return o(this,void 0,void 0,(function*(){const r="http://www.w3.org/2000/svg",i=document.createElementNS(r,"svg"),c=document.createElementNS(r,"foreignObject");return i.setAttribute("width",`${e}`),i.setAttribute("height",`${n}`),i.setAttribute("viewBox",`0 0 ${e} ${n}`),c.setAttribute("width","100%"),c.setAttribute("height","100%"),c.setAttribute("x","0"),c.setAttribute("y","0"),c.setAttribute("externalResourcesRequired","true"),i.appendChild(c),c.appendChild(t),function(t){return o(this,void 0,void 0,(function*(){return Promise.resolve().then((()=>(new XMLSerializer).serializeToString(t))).then(encodeURIComponent).then((t=>`data:image/svg+xml;charset=utf-8,${t}`))}))}(i)}))}(t,n,r)))}))}const U=16384;function j(t,e={}){return D(this,void 0,void 0,(function*(){return H(t,e).then(p).then((n=>{const o=document.createElement("canvas"),r=o.getContext("2d"),i=e.pixelRatio||function(){let t,e;try{e=process}catch(t){}const n=e&&e.env?e.env.devicePixelRatio:null;return n&&(t=parseInt(n,10),Number.isNaN(t)&&(t=1)),t||window.devicePixelRatio||1}(),{width:c,height:s}=V(t,e),u=e.canvasWidth||c,l=e.canvasHeight||s;return o.width=u*i,o.height=l*i,e.skipAutoScale||function(t){(t.width>U||t.height>U)&&(t.width>U&&t.height>U?t.width>t.height?(t.height*=U/t.width,t.width=U):(t.width*=U/t.height,t.height=U):t.width>U?(t.height*=U/t.width,t.width=U):(t.width*=U/t.height,t.height=U))}(o),o.style.width=`${u}`,o.style.height=`${l}`,e.backgroundColor&&(r.fillStyle=e.backgroundColor,r.fillRect(0,0,o.width,o.height)),r.drawImage(n,0,0,o.width,o.height),o}))}))}function F(t,e={}){return D(this,void 0,void 0,(function*(){const{width:n,height:o}=V(t,e);return j(t,e).then((t=>t.getContext("2d").getImageData(0,0,n,o).data))}))}function _(t,e={}){return D(this,void 0,void 0,(function*(){return j(t,e).then((t=>t.toDataURL()))}))}function B(t,e={}){return D(this,void 0,void 0,(function*(){return j(t,e).then((t=>t.toDataURL("image/jpeg",e.quality||1)))}))}function O(t,e={}){return D(this,void 0,void 0,(function*(){return j(t,e).then(d)}))}function z(t,e={}){return D(this,void 0,void 0,(function*(){return M(t,e)}))}}}]);
//# sourceMappingURL=chunk-html-to-image.js.map